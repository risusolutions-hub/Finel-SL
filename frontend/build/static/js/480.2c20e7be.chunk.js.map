{"version":3,"file":"static/js/480.2c20e7be.chunk.js","mappings":"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","sources":["../node_modules/lucide-react/src/icons/loader-circle.ts","../node_modules/lucide-react/src/icons/star.ts","context/AppContext.js","components/dashboard/modals/AssignEngineerModal.js"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'M21 12a9 9 0 1 1-6.219-8.56', key: '13zald' }]];\n\n/**\n * @component @name LoaderCircle\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEgMTJhOSA5IDAgMSAxLTYuMjE5LTguNTYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/loader-circle\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst LoaderCircle = createLucideIcon('loader-circle', __iconNode);\n\nexport default LoaderCircle;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z',\n      key: 'r04s7s',\n    },\n  ],\n];\n\n/**\n * @component @name Star\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTEuNTI1IDIuMjk1YS41My41MyAwIDAgMSAuOTUgMGwyLjMxIDQuNjc5YTIuMTIzIDIuMTIzIDAgMCAwIDEuNTk1IDEuMTZsNS4xNjYuNzU2YS41My41MyAwIDAgMSAuMjk0LjkwNGwtMy43MzYgMy42MzhhMi4xMjMgMi4xMjMgMCAwIDAtLjYxMSAxLjg3OGwuODgyIDUuMTRhLjUzLjUzIDAgMCAxLS43NzEuNTZsLTQuNjE4LTIuNDI4YTIuMTIyIDIuMTIyIDAgMCAwLTEuOTczIDBMNi4zOTYgMjEuMDFhLjUzLjUzIDAgMCAxLS43Ny0uNTZsLjg4MS01LjEzOWEyLjEyMiAyLjEyMiAwIDAgMC0uNjExLTEuODc5TDIuMTYgOS43OTVhLjUzLjUzIDAgMCAxIC4yOTQtLjkwNmw1LjE2NS0uNzU1YTIuMTIyIDIuMTIyIDAgMCAwIDEuNTk3LTEuMTZ6IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/star\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Star = createLucideIcon('star', __iconNode);\n\nexport default Star;\n","import React, { createContext, useContext, useState, useCallback, useEffect } from 'react';\r\nimport api from '../api';\r\n\r\nconst AppContext = createContext(null);\r\n\r\nexport function AppProvider({ children, user, onUserUpdate }) {\r\n  // State\r\n  const [appState, setAppState] = useState({\r\n    customers: [],\r\n    machines: [],\r\n    engineers: [],\r\n    users: [],\r\n    complaints: [],\r\n    leaves: [],\r\n    models: ['Fiber 30W', 'Fiber 50W', 'CO2 100W', 'CO2 150W', 'UV Laser 5W', 'MOPA 60W']\r\n  });\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [toast, setToast] = useState(null);\r\n\r\n  // Toast helpers\r\n  const showToast = useCallback((message, type = 'info') => {\r\n    setToast({ message, type });\r\n    setTimeout(() => setToast(null), 5000);\r\n  }, []);\r\n\r\n  const hideToast = useCallback(() => {\r\n    setToast(null);\r\n  }, []);\r\n\r\n  // Load all data\r\n  const loadData = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const [customersRes, machinesRes, usersRes, complaintsRes] = await Promise.all([\r\n        api.get('/customers').catch(() => ({ data: { customers: [] } })),\r\n        api.get('/machines').catch(() => ({ data: { machines: [] } })),\r\n        api.get('/users').catch(() => ({ data: { users: [] } })),\r\n        api.get('/complaints').catch(() => ({ data: { complaints: [] } }))\r\n      ]);\r\n\r\n      let complaints = complaintsRes.data.complaints || [];\r\n\r\n      if (user?.role === 'engineer') {\r\n        const pendingRes = await api.get('/complaints?open=1').catch(() => ({ data: { complaints: [] } }));\r\n        const pending = pendingRes.data.complaints || [];\r\n        complaints = [...complaints, ...pending];\r\n        \r\n        try {\r\n          const meRes = await api.get('/auth/me');\r\n          setCurrentUser(meRes.data);\r\n        } catch (err) {\r\n          console.log('Could not load current user data');\r\n        }\r\n      }\r\n\r\n      const customers = (customersRes.data.customers || []).map(c => ({ ...c, id: String(c.id) }));\r\n      const machines = (machinesRes.data.machines || []).map(m => ({ ...m, id: String(m.id), customerId: String(m.customerId) }));\r\n      const allUsers = usersRes.data.users || [];\r\n      const engineers = allUsers.filter(u => u.role === 'engineer').map(e => ({ ...e, id: String(e.id) }));\r\n\r\n      const normalizedComplaints = complaints.map(c => ({\r\n        ...c,\r\n        id: String(c.id),\r\n        customerId: String(c.customerId),\r\n        machineId: String(c.machineId),\r\n        assignedTo: c.assignedTo ? String(c.assignedTo) : null,\r\n        displayId: c.complaintId || `TKT-${c.id}`,\r\n        status: c.status || 'pending',\r\n        workStatus: c.workStatus || 'pending'\r\n      }));\r\n\r\n      setAppState(prev => ({\r\n        ...prev,\r\n        customers,\r\n        machines,\r\n        engineers,\r\n        users: allUsers,\r\n        complaints: normalizedComplaints,\r\n      }));\r\n\r\n      // Load leaves\r\n      try {\r\n        const leavesRes = await api.get('/leaves').catch(() => ({ data: { leaves: [] } }));\r\n        const leaves = leavesRes.data.leaves || [];\r\n        setAppState(prev => ({ ...prev, leaves }));\r\n      } catch (err) {\r\n        console.log('Could not load leave data');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n      showToast('Error loading data', 'error');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user?.role, showToast]);\r\n\r\n  // Initial load\r\n  useEffect(() => {\r\n    loadData();\r\n  }, [loadData]);\r\n\r\n  // Live timer for daily work time + 7pm auto-checkout check\r\n  useEffect(() => {\r\n    if (user?.role !== 'engineer' || !currentUser?.isCheckedIn) {\r\n      return;\r\n    }\r\n\r\n    const interval = setInterval(() => {\r\n      const now = new Date();\r\n      const hour = now.getHours();\r\n      \r\n      // Check if it's 7:00 PM or later - trigger auto-checkout\r\n      if (hour >= 19 && currentUser?.isCheckedIn) {\r\n        api.post('/users/checkout').then(res => {\r\n          const dailyMins = res.data?.dailyTotalWorkTime || 0;\r\n          const hours = Math.floor(dailyMins / 60);\r\n          const mins = dailyMins % 60;\r\n          showToast(`⏰ Auto-checkout at 7:00 PM. Today's total: ${hours}h ${mins}m`, 'info');\r\n          setCurrentUser(res.data);\r\n        }).catch(err => {\r\n          console.error('Auto-checkout error:', err);\r\n        });\r\n        return;\r\n      }\r\n\r\n      setCurrentUser(prev => {\r\n        if (!prev || !prev.isCheckedIn || !prev.lastCheckIn) {\r\n          return prev;\r\n        }\r\n\r\n        const checkInTime = new Date(prev.lastCheckIn);\r\n        const nowTime = new Date();\r\n        \r\n        // Cap calculation time at 7pm\r\n        let endTime = nowTime;\r\n        if (nowTime.getHours() >= 19) {\r\n          endTime = new Date(nowTime);\r\n          endTime.setHours(19, 0, 0, 0);\r\n        }\r\n        \r\n        const elapsedMinutes = Math.floor((endTime.getTime() - checkInTime.getTime()) / 60000);\r\n        const baseDailyTime = prev.baseDailyWorkTime !== undefined ? prev.baseDailyWorkTime : (prev.dailyTotalWorkTime || 0);\r\n        const totalDailyWorkTime = baseDailyTime + elapsedMinutes;\r\n\r\n        return {\r\n          ...prev,\r\n          baseDailyWorkTime: baseDailyTime,\r\n          dailyTotalWorkTime: totalDailyWorkTime\r\n        };\r\n      });\r\n    }, 60000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [user?.role, currentUser?.isCheckedIn, currentUser?.lastCheckIn, showToast]);\r\n\r\n  // ===== USER MANAGEMENT =====\r\n  const createUser = useCallback(async (userData) => {\r\n    try {\r\n      await api.post('/users', userData);\r\n      loadData();\r\n      showToast('User created successfully', 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast(error.response?.data?.error || 'Error creating user', 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const updateUser = useCallback(async (userId, userData) => {\r\n    try {\r\n      await api.put(`/users/${userId}`, userData);\r\n      loadData();\r\n      showToast('User updated successfully', 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast(error.response?.data?.error || 'Error updating user', 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const deleteUser = useCallback(async (userId) => {\r\n    if (!window.confirm('Are you sure you want to delete this user?')) return false;\r\n    try {\r\n      await api.delete(`/users/${userId}`);\r\n      loadData();\r\n      showToast('User deleted', 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast('Error deleting user', 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const blockUser = useCallback(async (userId, shouldBlock) => {\r\n    const action = shouldBlock ? 'block' : 'unblock';\r\n    try {\r\n      await api.post(`/users/${userId}/${action}`);\r\n      loadData();\r\n      showToast(`User ${action}ed`, 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast(`Error ${action}ing user`, 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  // ===== COMPLAINT MANAGEMENT =====\r\n  const assignComplaint = useCallback(async (complaintId, engineerId) => {\r\n    if (!complaintId || complaintId === 'undefined') { showToast('Invalid complaint selected', 'error'); return false; }\r\n    if (!engineerId || engineerId === 'undefined') { showToast('Invalid engineer selected', 'error'); return false; }\r\n    try {\r\n      await api.post(`/complaints/${complaintId}/assign`, { engineerId });\r\n      loadData();\r\n      showToast('Engineer assigned successfully', 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast('Error assigning engineer', 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const cancelAssignment = useCallback(async (complaintId) => {\r\n    try {\r\n      await api.post(`/complaints/${complaintId}/unassign`);\r\n      loadData();\r\n      showToast('Assignment cancelled', 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast('Error cancelling assignment', 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const updateTicketStatus = useCallback(async (id, status) => {\r\n    try {\r\n      await api.put(`/complaints/${id}/status`, { status });\r\n      loadData();\r\n      showToast(`Status Updated: ${status}`, 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast('Error updating status', 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const completeTicket = useCallback(async (complaintId, solution, spares) => {\r\n    try {\r\n      await api.post(`/complaints/${complaintId}/complete`, { \r\n        workPerformed: solution, \r\n        solutionNotes: solution, \r\n        sparesUsed: spares \r\n      });\r\n      loadData();\r\n      showToast('Service completed and ticket closed.', 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast('Error completing ticket', 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const closeTicket = useCallback(async (complaintId, notes) => {\r\n    if (!notes.trim()) {\r\n      showToast('Closing requires notes', 'warning');\r\n      return false;\r\n    }\r\n    try {\r\n      await api.post(`/complaints/${complaintId}/close`, { solutionNotes: notes });\r\n      loadData();\r\n      showToast('Ticket closed with notes.', 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast('Error closing ticket', 'error');\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const createComplaint = useCallback(async (formData) => {\r\n    try {\r\n      // Treat ids as strings (Mongo ObjectId) — do NOT parseInt\r\n      let cid = formData.customerId && String(formData.customerId).trim() ? formData.customerId : null;\r\n      let mid = formData.machineId && String(formData.machineId).trim() ? formData.machineId : null;\r\n\r\n      // Build payload (backend will create nested customer/machine when provided)\r\n      const payload = {\r\n        problem: formData.problem,\r\n        priority: formData.priority || 'medium',\r\n        customerId: cid,\r\n        machineId: mid,\r\n        issueCategories: formData.issueCategories || [],\r\n        attachments: formData.attachments || []\r\n      };\r\n      if (formData.customerData) payload.customerData = formData.customerData;\r\n      if (formData.machineData) payload.machineData = formData.machineData;\r\n      if (formData.isNewCustomer !== undefined) payload.isNewCustomer = formData.isNewCustomer;\r\n      if (formData.isNewMachine !== undefined) payload.isNewMachine = formData.isNewMachine;\r\n      if (formData.serviceNo) payload.serviceNo = formData.serviceNo;\r\n\r\n      const res = await api.post('/complaints', payload);\r\n      if (res.data) {\r\n        const { complaint, customer, machine } = res.data;\r\n        setAppState(prev => {\r\n          const customers = customer ? [customer, ...prev.customers.filter(c => String(c._id || c.id) !== String(customer._id || customer.id))] : prev.customers;\r\n          const machines = machine ? [machine, ...prev.machines.filter(m => String(m._id || m.id) !== String(machine._id || machine.id))] : prev.machines;\r\n          const rawId = complaint._id || complaint.id || null;\r\n          const normalized = {\r\n            ...complaint,\r\n            id: rawId ? String(rawId) : null,\r\n            complaintId: complaint.complaintId,\r\n            customerId: customer ? (customer._id || customer.id ? String(customer._id || customer.id) : null) : (complaint.customerId ? String(complaint.customerId) : null),\r\n            machineId: machine ? (machine._id || machine.id ? String(machine._id || machine.id) : null) : (complaint.machineId ? String(complaint.machineId) : null),\r\n            displayId: complaint.complaintId || (rawId ? `TKT-${String(rawId).slice(0,8)}` : null)\r\n          };\r\n          const complaints = [normalized, ...prev.complaints];\r\n          return { ...prev, customers, machines, complaints };\r\n        });\r\n        return { complaint: res.data.complaint, customer: res.data.customer, machine: res.data.machine };\r\n      }\r\n      return null;\r\n    } catch (error) {\r\n      // Bubble up dup-serial 409 for caller to handle similarly to Dashboard\r\n      if (error.response?.status === 409) throw error;\r\n      showToast(error.response?.data?.error || 'Error creating complaint', 'error');\r\n      return null;\r\n    }\r\n  }, [setAppState, showToast]);\r\n\r\n  // ===== ENGINEER CHECK-IN/OUT =====\r\n  const checkIn = useCallback(async () => {\r\n    try {\r\n      const res = await api.post('/users/check-in');\r\n      const userData = res.data;\r\n      setCurrentUser({ ...userData, baseDailyWorkTime: userData.dailyTotalWorkTime || 0 });\r\n      showToast('✓ Checked in for the day. Let\\'s get to work!', 'success');\r\n      return true;\r\n    } catch (error) {\r\n      if (error.response?.data) {\r\n        const errorMsg = error.response.data.error;\r\n        if (errorMsg === 'Already checked in') {\r\n          showToast('You are already checked in.', 'info');\r\n          loadData();\r\n        } else if (errorMsg.includes('Check-in is only allowed')) {\r\n          showToast(errorMsg, 'error');\r\n        } else {\r\n          showToast('Error checking in', 'error');\r\n        }\r\n      } else {\r\n        showToast('Error checking in', 'error');\r\n      }\r\n      return false;\r\n    }\r\n  }, [loadData, showToast]);\r\n\r\n  const checkOut = useCallback(async () => {\r\n    try {\r\n      const res = await api.post('/users/check-out');\r\n      setCurrentUser(res.data);\r\n      const hours = Math.floor((res.data?.dailyTotalWorkTime || 0) / 60);\r\n      const mins = (res.data?.dailyTotalWorkTime || 0) % 60;\r\n      const message = res.data?.autoCheckout \r\n        ? `✓ Auto checkout at 7:00 PM. Today's total work time: ${hours}h ${mins}m`\r\n        : `✓ Checked out. Today's total work time: ${hours}h ${mins}m`;\r\n      showToast(message, 'success');\r\n      return true;\r\n    } catch (error) {\r\n      showToast('Error checking out', 'error');\r\n      return false;\r\n    }\r\n  }, [showToast]);\r\n\r\n  const updateName = useCallback(async (newName) => {\r\n    try {\r\n      const res = await api.put(`/users/${user.id}`, { name: newName });\r\n      if (onUserUpdate) {\r\n        onUserUpdate({ ...user, name: newName });\r\n      }\r\n      showToast('✓ Profile updated successfully!', 'success');\r\n      loadData();\r\n      return res.data;\r\n    } catch (error) {\r\n      showToast('Error updating profile', 'error');\r\n      return null;\r\n    }\r\n  }, [user, onUserUpdate, loadData, showToast]);\r\n\r\n  const value = {\r\n    // State\r\n    appState,\r\n    currentUser,\r\n    loading,\r\n    toast,\r\n    user,\r\n    \r\n    // Toast\r\n    showToast,\r\n    hideToast,\r\n    \r\n    // Data loading\r\n    loadData,\r\n    \r\n    // User management\r\n    createUser,\r\n    updateUser,\r\n    deleteUser,\r\n    blockUser,\r\n    \r\n    // Complaint management\r\n    assignComplaint,\r\n    cancelAssignment,\r\n    updateTicketStatus,\r\n    completeTicket,\r\n    closeTicket,\r\n    createComplaint,\r\n    \r\n    // Engineer actions\r\n    checkIn,\r\n    checkOut,\r\n    updateName,\r\n    setCurrentUser\r\n  };\r\n\r\n  return (\r\n    <AppContext.Provider value={value}>\r\n      {children}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useApp() {\r\n  const context = useContext(AppContext);\r\n  if (!context) {\r\n    throw new Error('useApp must be used within an AppProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\nexport default AppContext;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { X, Check, Zap, Star, Award, Loader2 } from 'lucide-react';\r\nimport api from '../../../api';\r\nimport { useApp } from '../../../context';\r\n\r\nexport default function AssignEngineerModal({ complaint, engineers, onAssign, onClose }) {\r\n  const [suggestions, setSuggestions] = useState([]);\r\n  const [loadingSuggestions, setLoadingSuggestions] = useState(false);\r\n  const [autoAssigning, setAutoAssigning] = useState(false);\r\n  const [showSuggestions, setShowSuggestions] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!complaint || !complaint.id) return;\r\n    loadSuggestions();\r\n  }, [complaint?.id]);\r\n\r\n  // Access app-level loadData if available (guarded for safety)\r\n  let loadData = null;\r\n  try {\r\n    const appCtx = useApp();\r\n    loadData = appCtx?.loadData || null;\r\n  } catch (e) {\r\n    // not running inside AppProvider context; fall back to no-op\r\n    loadData = null;\r\n  }\r\n\r\n  const loadSuggestions = async () => {\r\n    if (!complaint || !complaint.id) return;\r\n    try {\r\n      setLoadingSuggestions(true);\r\n      const res = await api.get(`/complaints/${complaint.id}/suggested-engineers`);\r\n      if (res.data && res.data.suggestions) {\r\n        setSuggestions(res.data.suggestions || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading suggestions:', error);\r\n    } finally {\r\n      setLoadingSuggestions(false);\r\n    }\r\n  };\r\n\r\n  const handleAutoAssign = async () => {\r\n    try {\r\n      setAutoAssigning(true);\r\n      const res = await api.post(`/complaints/${complaint.id}/auto-assign`);\r\n      if (res.data.success) {\r\n        onClose();\r\n        // Refresh data from server to reflect assignment\r\n        loadData();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error auto-assigning:', error);\r\n      alert(error.response?.data?.error || 'Failed to auto-assign');\r\n    } finally {\r\n      setAutoAssigning(false);\r\n    }\r\n  };\r\n\r\n  const getSuggestedEngineer = (engineerId) => {\r\n    return suggestions.find(s => s.id === parseInt(engineerId));\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-slate-900/60 flex z-50 items-center justify-center backdrop-blur-sm p-4\">\r\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-lg border border-slate-200\">\r\n        <div className=\"px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-slate-50 rounded-t-lg\">\r\n          <div>\r\n            <h3 className=\"text-sm font-semibold text-slate-900\">Assign Engineer</h3>\r\n            <p className=\"text-xs text-slate-500 mt-0.5\">Ticket #{complaint.displayId || complaint.id}</p>\r\n          </div>\r\n          <button onClick={onClose} className=\"p-1 hover:bg-slate-200 rounded text-slate-400 hover:text-slate-600 transition-colors\">\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Auto-Assign Button */}\r\n        <div className=\"p-4 border-b border-slate-200 bg-gradient-to-r from-blue-50 to-purple-50\">\r\n          <button\r\n            onClick={handleAutoAssign}\r\n            disabled={autoAssigning}\r\n            className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg px-4 py-3 font-medium flex items-center justify-center gap-2 hover:from-blue-700 hover:to-purple-700 transition disabled:opacity-50\"\r\n          >\r\n            {autoAssigning ? (\r\n              <>\r\n                <Loader2 size={18} className=\"animate-spin\" />\r\n                Finding Best Match...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Zap size={18} />\r\n                Auto-Assign Best Engineer\r\n              </>\r\n            )}\r\n          </button>\r\n          <p className=\"text-xs text-slate-500 text-center mt-2\">\r\n            Automatically assigns based on skills, availability, and experience\r\n          </p>\r\n        </div>\r\n\r\n        {/* Suggested Engineers */}\r\n        {showSuggestions && suggestions.length > 0 && (\r\n          <div className=\"p-4 border-b border-slate-200\">\r\n            <h4 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2\">\r\n              <Star size={12} className=\"text-yellow-500\" />\r\n              AI Suggestions\r\n            </h4>\r\n            <div className=\"space-y-2\">\r\n              {suggestions.slice(0, 3).map(s => (\r\n                <button\r\n                  key={s.id}\r\n                  onClick={() => onAssign(complaint.id, s.id)}\r\n                  className=\"w-full text-left p-3 rounded-md border border-yellow-200 bg-yellow-50 hover:border-yellow-300 hover:bg-yellow-100 transition-all\"\r\n                >\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div>\r\n                      <p className=\"font-medium text-sm text-slate-900 flex items-center gap-2\">\r\n                        {s.name}\r\n                        {s.matchingSkills?.length > 0 && (\r\n                          <span className=\"bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full\">\r\n                            {s.matchingSkills.length} skill match\r\n                          </span>\r\n                        )}\r\n                      </p>\r\n                      {s.matchingSkills?.length > 0 && (\r\n                        <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                          {s.matchingSkills.map((skill, i) => (\r\n                            <span key={i} className=\"text-xs bg-white text-slate-600 px-2 py-0.5 rounded border border-slate-200\">\r\n                              {skill.name} ({skill.level})\r\n                            </span>\r\n                          ))}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <span className={`px-2 py-1 rounded text-xs font-medium ${\r\n                      s.isAvailable ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'\r\n                    }`}>\r\n                      {s.isAvailable ? 'Available' : 'Busy'}\r\n                    </span>\r\n                  </div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        <div className=\"p-4 max-h-[40vh] overflow-y-auto\">\r\n          <h4 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">All Engineers</h4>\r\n          <div className=\"space-y-2\">\r\n            {engineers.map((e, idx) => {\r\n              const suggestion = getSuggestedEngineer(e.id || e._id);\r\n              const engKey = e.id || e._id || `eng-${idx}`;\r\n              const engId = e._id || e.id;\r\n              return (\r\n                <button\r\n                  key={engKey}\r\n                  onClick={() => onAssign(complaint.id, engId)}\r\n                  className=\"w-full text-left p-3 rounded-md border border-slate-200 hover:border-blue-300 hover:bg-blue-50 transition-all flex justify-between items-center group\"\r\n                >\r\n                  <div>\r\n                    <p className=\"font-medium text-sm text-slate-900 group-hover:text-blue-700 flex items-center gap-2\">\r\n                      {e.name}\r\n                      {suggestion?.matchingSkills?.length > 0 && (\r\n                        <Award size={14} className=\"text-yellow-500\" />\r\n                      )}\r\n                    </p>\r\n                    <p className=\"text-xs text-slate-500\">{e.location || 'Unknown Location'} • Rating: {e.rating || 'N/A'}</p>\r\n                  </div>\r\n                  <div className={`px-2 py-1 rounded text-xs font-medium border ${(e.status || 'Available') === 'Available' ? 'bg-emerald-50 text-emerald-700 border-emerald-100' : 'bg-amber-50 text-amber-700 border-amber-100'}`}>\r\n                     {e.status || 'Available'}\r\n                  </div>\r\n                </button>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"px-6 py-4 border-t border-slate-100 bg-slate-50/50 rounded-b-lg text-right\">\r\n             <span className=\"text-xs text-slate-400\">Select an engineer to immediately assign</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["LoaderCircle","createLucideIcon","d","key","Star","AppContext","createContext","AssignEngineerModal","_ref","complaint","engineers","onAssign","onClose","suggestions","setSuggestions","useState","loadingSuggestions","setLoadingSuggestions","autoAssigning","setAutoAssigning","showSuggestions","setShowSuggestions","useEffect","id","loadSuggestions","loadData","appCtx","context","useContext","Error","useApp","e","async","res","api","get","concat","data","error","console","_jsx","className","children","_jsxs","displayId","onClick","X","post","success","_error$response","_error$response$data","alert","response","disabled","_Fragment","Loader2","size","Zap","length","slice","map","s","_s$matchingSkills","_s$matchingSkills2","name","matchingSkills","skill","i","level","isAvailable","idx","_suggestion$matchingS","suggestion","engineerId","_id","find","parseInt","engKey","engId","Award","location","rating","status"],"ignoreList":[],"sourceRoot":""}