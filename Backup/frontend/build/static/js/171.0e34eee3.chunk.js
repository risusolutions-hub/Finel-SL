/*! For license information please see 171.0e34eee3.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkrole_based_frontend=self.webpackChunkrole_based_frontend||[]).push([[171],{67(e,s,r){r.d(s,{A:()=>t});const t=(0,r(5228).A)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},1286(e,s,r){r.d(s,{A:()=>t});const t=(0,r(5228).A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])},2024(e,s,r){r.d(s,{A:()=>t});const t=(0,r(5228).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5171(e,s,r){r.r(s),r.d(s,{default:()=>C});var t=r(9379),a=r(5043),l=r(67),n=r(9333),i=r(1680),o=r(614),c=r(9292),m=r(2024),d=r(2054),u=r(7819),x=r(3639),h=r(1286),p=r(8280),b=r(1360),y=r(5228);const f=(0,y.A)("file-exclamation-point",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),g=(0,y.A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var N=r(9855),v=r(349),j=r(674),w=r(579);const A=[{id:"electrical",label:"Electrical Issue"},{id:"mechanical",label:"Mechanical Issue"},{id:"software",label:"Software/Firmware"},{id:"cooling",label:"Cooling/Temperature"},{id:"network",label:"Network/Connectivity"},{id:"display",label:"Display/Screen"},{id:"power",label:"Power Supply"},{id:"noise",label:"Noise/Vibration"},{id:"performance",label:"Performance Issue"},{id:"other",label:"Other"}],k=[{value:"low",label:"Low",color:"bg-green-100 text-green-700 border-green-300",description:"Can wait"},{value:"medium",label:"Medium",color:"bg-yellow-100 text-yellow-700 border-yellow-300",description:"Regular"},{value:"high",label:"High",color:"bg-orange-100 text-orange-700 border-orange-300",description:"Urgent"},{value:"critical",label:"Critical",color:"bg-red-100 text-red-700 border-red-300",description:"Emergency"}];function C(e){var s;let{appState:r,user:y,isNewClient:C,isNewMachine:D,setIsNewClient:I,setIsNewMachine:M,onSubmit:S,onClose:P,showToast:z}=e;const[E,F]=(0,a.useState)(!1),[q,T]=(0,a.useState)(!1),[L,U]=(0,a.useState)(""),[V,B]=(0,a.useState)(null),[O,R]=(0,a.useState)(!1),[_,H]=(0,a.useState)(!1),K=(0,a.useRef)(null),[W,G]=(0,a.useState)({customerId:"",machineId:"",problem:"",priority:"medium",issueCategories:[],customIssue:"",serviceNo:"",attachments:[],isNewCustomer:!1,isNewMachine:!1,customerData:{companyName:"",contactPerson:"",city:"",phone:"",phones:[""],address:"",email:"",serviceNo:""},machineData:{model:"",serialNumber:"",mobileNumbers:[""]}}),[J,Q]=(0,a.useState)([]),X=async()=>{if(L.trim()){R(!0),H(!0);try{const e=await j.A.get("/customers/search-by-service?serviceNo=".concat(encodeURIComponent(L.trim()))),{found:s,customer:r,machines:a}=e.data;s&&r?(B(r),Q(a||[]),G(e=>{var s;return(0,t.A)((0,t.A)({},e),{},{customerId:r.id,serviceNo:r.serviceNo,isNewCustomer:!1,customerData:{companyName:r.companyName||r.name||r.company||"",contactPerson:r.contactPerson||"",city:r.city||"",phone:r.phone||"",phones:(null===(s=r.phones)||void 0===s?void 0:s.length)>0?r.phones:[r.phone||""],address:r.address||"",email:r.email||"",serviceNo:r.serviceNo||""}})}),I(!1),M(!1),z("Customer found!","success")):Y()}catch(a){var e;console.error("Error searching service no:",a);const l=null===(e=r.customers)||void 0===e?void 0:e.find(e=>{var s;return(null===(s=e.serviceNo)||void 0===s?void 0:s.toLowerCase())===L.trim().toLowerCase()});if(l){var s;B(l);const e=(null===(s=r.machines)||void 0===s?void 0:s.filter(e=>e.customerId===l.id))||[];Q(e),G(e=>{var s;return(0,t.A)((0,t.A)({},e),{},{customerId:l.id,serviceNo:l.serviceNo,isNewCustomer:!1,customerData:{companyName:l.companyName||l.name||"",contactPerson:l.contactPerson||"",city:l.city||"",phone:l.phone||"",phones:(null===(s=l.phones)||void 0===s?void 0:s.length)>0?l.phones:[l.phone||""],address:l.address||"",email:l.email||"",serviceNo:l.serviceNo||""}})}),I(!1),M(!1),z("Customer found!","success")}else Y()}finally{R(!1)}}else z("Please enter a service number","warning")},Y=()=>{B(null),Q([]),G(e=>(0,t.A)((0,t.A)({},e),{},{customerId:"",serviceNo:L.trim(),isNewCustomer:!0,customerData:{serviceNo:L.trim(),companyName:"",contactPerson:"",city:"",phone:"",phones:[""],address:"",email:""}})),I(!0),M(!0),z("New customer - Please fill in details","info")};(0,a.useEffect)(()=>{if(W.customerId&&!C){var e;const s=parseInt(W.customerId),t=(null===(e=r.machines)||void 0===e?void 0:e.filter(e=>e.customerId===s))||[];Q(t)}},[W.customerId,r.machines,C]);const Z=e=>{const{name:s,value:r}=e.target;G(e=>(0,t.A)((0,t.A)({},e),{},{[s]:r}))},$=e=>{const{name:s,value:r}=e.target;G(e=>(0,t.A)((0,t.A)({},e),{},{customerData:(0,t.A)((0,t.A)({},e.customerData),{},{[s]:r})}))},ee=e=>{const{name:s,value:r}=e.target;G(e=>(0,t.A)((0,t.A)({},e),{},{machineData:(0,t.A)((0,t.A)({},e.machineData),{},{[s]:r})}))};return(0,w.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,w.jsxs)("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[95vh] overflow-hidden flex flex-col shadow-2xl",children:[(0,w.jsxs)("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 text-white px-6 py-4 flex items-center justify-between",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:"Create Service Ticket"}),(0,w.jsx)("p",{className:"text-primary-100 text-sm mt-0.5",children:"Fill in all required details below"})]}),(0,w.jsx)("button",{onClick:P,className:"p-2 hover:bg-primary-500 rounded-lg transition-colors",disabled:E,title:"Close",children:(0,w.jsx)(o.A,{size:22})})]}),E&&(0,w.jsx)(v.A,{}),!E&&(0,w.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,w.jsxs)("div",{className:"p-6 border-b border-neutral-200 bg-neutral-50",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,w.jsx)("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center",children:(0,w.jsx)(c.A,{size:20,className:"text-primary-600"})}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"font-semibold text-neutral-900",children:"Step 1: Service Number"}),(0,w.jsx)("p",{className:"text-xs text-neutral-500",children:"Search customer by service number"})]})]}),(0,w.jsxs)("div",{className:"flex gap-3",children:[(0,w.jsxs)("div",{className:"flex-1 relative",children:[(0,w.jsx)("input",{type:"text",value:L,onChange:e=>U(e.target.value),onKeyPress:e=>"Enter"===e.key&&X(),placeholder:"Enter service number (e.g., SVC-001)",className:"w-full px-4 py-2.5 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm",autoFocus:!0}),O&&(0,w.jsx)(m.A,{size:18,className:"absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-primary-600"})]}),(0,w.jsxs)("button",{onClick:X,disabled:!L.trim()||O,className:"px-5 py-2.5 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2 text-sm",children:[(0,w.jsx)(c.A,{size:16}),"Search"]})]}),_&&V&&(0,w.jsxs)("div",{className:"mt-4 p-3 bg-emerald-50 border border-emerald-200 rounded-lg flex items-center gap-3",children:[(0,w.jsx)(d.A,{size:20,className:"text-emerald-600 flex-shrink-0"}),(0,w.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,w.jsx)("p",{className:"font-medium text-emerald-900 truncate",children:V.companyName||V.name}),(0,w.jsxs)("p",{className:"text-emerald-700 text-xs",children:[V.city," \u2022 ",V.phone]})]})]}),_&&!V&&C&&(0,w.jsxs)("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-3",children:[(0,w.jsx)(u.A,{size:20,className:"text-amber-600 flex-shrink-0"}),(0,w.jsxs)("div",{children:[(0,w.jsx)("p",{className:"font-medium text-amber-900 text-sm",children:"New Customer"}),(0,w.jsx)("p",{className:"text-amber-700 text-xs",children:"Service number not found. Please fill in customer details below."})]})]})]}),_&&(0,w.jsxs)("div",{className:"p-6 border-b border-neutral-200",children:[(0,w.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center",children:(0,w.jsx)(x.A,{size:20,className:"text-primary-600"})}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"font-semibold text-neutral-900",children:"Step 2: Customer Details"}),(0,w.jsx)("p",{className:"text-xs text-neutral-500",children:C?"Enter new customer information":"Customer information"})]})]})}),C?(0,w.jsx)("div",{className:"space-y-4",children:(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,w.jsxs)("div",{className:"col-span-2 sm:col-span-1",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Service No"}),(0,w.jsx)("input",{type:"text",name:"serviceNo",value:W.customerData.serviceNo,onChange:$,className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-neutral-50 text-sm",readOnly:!0})]}),(0,w.jsxs)("div",{className:"col-span-2 sm:col-span-1",children:[(0,w.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:["Company Name ",(0,w.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,w.jsx)("input",{type:"text",name:"companyName",value:W.customerData.companyName,onChange:$,placeholder:"Enter company name",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm",required:!0})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Contact Person"}),(0,w.jsx)("input",{type:"text",name:"contactPerson",value:W.customerData.contactPerson,onChange:$,placeholder:"Contact person name",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"City"}),(0,w.jsx)("input",{type:"text",name:"city",value:W.customerData.city,onChange:$,placeholder:"City",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"})]}),(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Address"}),(0,w.jsx)("input",{type:"text",name:"address",value:W.customerData.address,onChange:$,placeholder:"Full address",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Email"}),(0,w.jsx)("input",{type:"email",name:"email",value:W.customerData.email,onChange:$,placeholder:"email@example.com",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"})]}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:["Phone ",(0,w.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,w.jsxs)("div",{className:"relative",children:[(0,w.jsx)(h.A,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"}),(0,w.jsx)("input",{type:"tel",value:(Array.isArray(W.customerData.phones)?W.customerData.phones:[""])[0]||"",onChange:e=>{return s=0,r=e.target.value,void G(e=>(0,t.A)((0,t.A)({},e),{},{customerData:(0,t.A)((0,t.A)({},e.customerData),{},{phones:Array.isArray(e.customerData.phones)?e.customerData.phones.map((e,t)=>t===s?r:e):[r]})}));var s,r},placeholder:"Primary phone",className:"w-full pl-10 pr-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"})]})]})]})}):V&&(0,w.jsx)("div",{className:"p-4 bg-primary-50 border border-primary-200 rounded-lg",children:(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{className:"text-primary-600 text-xs",children:"Company"}),(0,w.jsx)("p",{className:"font-medium text-primary-900",children:V.companyName||V.name})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{className:"text-primary-600 text-xs",children:"Contact"}),(0,w.jsx)("p",{className:"font-medium text-primary-900",children:V.contactPerson||"-"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{className:"text-primary-600 text-xs",children:"City"}),(0,w.jsx)("p",{className:"font-medium text-primary-900",children:V.city||"-"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{className:"text-primary-600 text-xs",children:"Phone"}),(0,w.jsx)("p",{className:"font-medium text-primary-900",children:V.phone||"-"})]}),V.address&&(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("span",{className:"text-primary-600 text-xs",children:"Address"}),(0,w.jsx)("p",{className:"font-medium text-primary-900",children:V.address})]})]})})]}),_&&(0,w.jsxs)("div",{className:"p-6 border-b border-neutral-200",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center",children:(0,w.jsx)(p.A,{size:20,className:"text-primary-600"})}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"font-semibold text-neutral-900",children:"Step 3: Machine Details"}),(0,w.jsx)("p",{className:"text-xs text-neutral-500",children:D?"Add new machine":"Select or add machine"})]})]}),!C&&J.length>0&&(0,w.jsxs)("button",{type:"button",onClick:()=>M(!D),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium bg-neutral-800 text-white rounded-md hover:bg-neutral-900 transition-colors",children:[(0,w.jsx)(b.A,{size:14}),D?"Select Existing":"New Machine"]})]}),!C&&!D&&J.length>0&&(0,w.jsxs)("div",{className:"space-y-3",children:[(0,w.jsxs)("select",{name:"machineId",value:W.machineId,onChange:Z,className:"w-full px-3 py-2.5 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm",children:[(0,w.jsx)("option",{value:"",children:"Select a machine"}),J.map(e=>(0,w.jsxs)("option",{value:e.id,children:[e.model," - ",e.serialNumber]},e.id))]}),W.machineId&&(0,w.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg text-sm",children:(()=>{const e=J.find(e=>e.id===parseInt(W.machineId));return e?(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)(d.A,{size:18,className:"text-green-600"}),(0,w.jsxs)("div",{children:[(0,w.jsx)("p",{className:"font-medium text-green-900",children:e.model}),(0,w.jsxs)("p",{className:"text-green-700 text-xs",children:["Serial: ",e.serialNumber]})]})]}):null})()})]}),!C&&!D&&0===J.length&&(0,w.jsxs)("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg text-center",children:[(0,w.jsx)(u.A,{size:24,className:"mx-auto text-amber-600 mb-2"}),(0,w.jsx)("p",{className:"text-amber-800 font-medium text-sm",children:"No machines found for this customer"}),(0,w.jsx)("button",{type:"button",onClick:()=>M(!0),className:"mt-2 px-4 py-1.5 bg-neutral-800 text-white rounded-md hover:bg-neutral-900 font-medium text-sm transition-colors",children:"Add New Machine"})]}),(D||C)&&(0,w.jsx)("div",{className:"space-y-4",children:(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:["Model ",(0,w.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,w.jsx)("input",{type:"text",name:"model",value:W.machineData.model,onChange:ee,placeholder:"Machine model",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm",required:!0}),(null===(s=r.models)||void 0===s?void 0:s.length)>0&&(0,w.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:r.models.slice(0,4).map(e=>(0,w.jsx)("button",{type:"button",onClick:()=>G(s=>(0,t.A)((0,t.A)({},s),{},{machineData:(0,t.A)((0,t.A)({},s.machineData),{},{model:e})})),className:"text-xs px-2 py-1 bg-neutral-100 text-neutral-700 rounded hover:bg-neutral-200 transition-colors",children:e},e))})]}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:["Serial Number ",(0,w.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,w.jsx)("input",{type:"text",name:"serialNumber",value:W.machineData.serialNumber,onChange:ee,placeholder:"Serial number",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm",required:!0})]}),(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Machine Contact Number"}),(0,w.jsxs)("div",{className:"relative",children:[(0,w.jsx)(h.A,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"}),(0,w.jsx)("input",{type:"tel",value:W.machineData.mobileNumbers[0]||"",onChange:e=>{return s=0,r=e.target.value,void G(e=>(0,t.A)((0,t.A)({},e),{},{machineData:(0,t.A)((0,t.A)({},e.machineData),{},{mobileNumbers:e.machineData.mobileNumbers.map((e,t)=>t===s?r:e)})}));var s,r},placeholder:"Contact number for this machine",className:"w-full pl-10 pr-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"})]})]})]})})]}),_&&(0,w.jsxs)("div",{className:"p-6",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,w.jsx)("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center",children:(0,w.jsx)(f,{size:20,className:"text-primary-600"})}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"font-semibold text-neutral-900",children:"Step 4: Issue Details"}),(0,w.jsx)("p",{className:"text-xs text-neutral-500",children:"Describe the problem and attach files"})]})]}),(0,w.jsxs)("div",{className:"space-y-5",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Priority Level"}),(0,w.jsx)("div",{className:"grid grid-cols-4 gap-2",children:k.map(e=>(0,w.jsx)("button",{type:"button",onClick:()=>{return s=e.value,void G(e=>(0,t.A)((0,t.A)({},e),{},{priority:s}));var s},className:"p-2 rounded-lg border-2 transition-colors text-center ".concat(W.priority===e.value?e.color+" border-current":"bg-white border-neutral-200 hover:border-neutral-300"),children:(0,w.jsx)("p",{className:"font-semibold text-xs",children:e.label})},e.value))})]}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:["Issue Type ",(0,w.jsx)("span",{className:"text-neutral-400 font-normal",children:"(select all that apply)"})]}),(0,w.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:A.map(e=>(0,w.jsxs)("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer transition-colors text-sm ".concat(W.issueCategories.includes(e.id)?"bg-primary-50 border-primary-300":"border-neutral-200 hover:border-neutral-300 hover:bg-neutral-50"),children:[(0,w.jsx)("input",{type:"checkbox",checked:W.issueCategories.includes(e.id),onChange:()=>{return s=e.id,void G(e=>(0,t.A)((0,t.A)({},e),{},{issueCategories:e.issueCategories.includes(s)?e.issueCategories.filter(e=>e!==s):[...e.issueCategories,s]}));var s},className:"w-4 h-4 rounded border-neutral-300 text-primary-600 focus:ring-primary-500"}),(0,w.jsx)("span",{className:"text-neutral-800 text-xs font-medium",children:e.label})]},e.id))})]}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:["Problem Description ",(0,w.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,w.jsx)("textarea",{name:"problem",value:W.problem,onChange:Z,placeholder:"Describe the issue in detail...",rows:"3",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm",required:!0})]}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:["Other Issue ",(0,w.jsx)("span",{className:"text-neutral-400 font-normal",children:"(optional)"})]}),(0,w.jsx)("input",{type:"text",name:"customIssue",value:W.customIssue,onChange:Z,placeholder:"Any other issue not listed above",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Attachments"}),(0,w.jsxs)("div",{onClick:()=>{var e;return null===(e=K.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed border-neutral-300 rounded-lg p-4 text-center cursor-pointer hover:border-primary-400 hover:bg-primary-50/50 transition-colors",children:[(0,w.jsx)("input",{ref:K,type:"file",multiple:!0,accept:"image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.txt",onChange:async e=>{const s=Array.from(e.target.files);if(0===s.length)return;const r=s.filter(e=>!(e.size>104857600)||(z("".concat(e.name," is too large (max 100MB)"),"warning"),!1));if(0!==r.length){T(!0);try{const e=new FormData;r.forEach(s=>{e.append("files",s)}),e.append("complaintId","new-ticket");const s=await fetch("/api/uploads/ticket-attachments",{method:"POST",credentials:"include",body:e}),a=await s.json();a.success?(G(e=>(0,t.A)((0,t.A)({},e),{},{attachments:[...e.attachments,...a.attachments]})),z("".concat(a.attachments.length," file(s) uploaded"),"success")):z(a.error||"Upload failed","error")}catch(a){console.error("Upload error:",a),z("Failed to upload files","error")}finally{T(!1),K.current&&(K.current.value="")}}},className:"hidden"}),q?(0,w.jsxs)("div",{className:"flex items-center justify-center gap-2 text-primary-600",children:[(0,w.jsx)(m.A,{size:20,className:"animate-spin"}),(0,w.jsx)("span",{className:"text-sm",children:"Uploading..."})]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(g,{size:24,className:"mx-auto text-neutral-400 mb-1"}),(0,w.jsx)("p",{className:"text-neutral-600 text-sm",children:"Click to upload files"}),(0,w.jsx)("p",{className:"text-neutral-400 text-xs",children:"Images, Videos, PDF, Documents"})]})]}),W.attachments.length>0&&(0,w.jsx)("div",{className:"mt-3 space-y-2",children:W.attachments.map((e,s)=>{return(0,w.jsxs)("div",{className:"flex items-center gap-3 p-2 bg-neutral-50 rounded-lg",children:[(a=e.type,null!==a&&void 0!==a&&a.startsWith("image/")?(0,w.jsx)(l.A,{size:20,className:"text-blue-500"}):null!==a&&void 0!==a&&a.startsWith("video/")?(0,w.jsx)(n.A,{size:20,className:"text-purple-500"}):(0,w.jsx)(i.A,{size:20,className:"text-gray-500"})),(0,w.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,w.jsx)("p",{className:"font-medium text-neutral-900 text-sm truncate",children:e.originalName||e.name}),(0,w.jsx)("p",{className:"text-xs text-neutral-500",children:(r=e.size,r<1024?r+" B":r<1048576?(r/1024).toFixed(1)+" KB":(r/1048576).toFixed(1)+" MB")})]}),(0,w.jsx)("button",{type:"button",onClick:()=>(async e=>{const s=W.attachments[e];try{const e=new URLSearchParams({yearMonth:s.yearMonth||"",storageType:s.storageType||"local",remotePath:s.remotePath||""});await fetch("/api/uploads/ticket-attachments/".concat(s.filename,"?").concat(e),{method:"DELETE",credentials:"include"})}catch(r){console.error("Error deleting file:",r)}G(s=>(0,t.A)((0,t.A)({},s),{},{attachments:s.attachments.filter((s,r)=>r!==e)}))})(s),className:"p-1.5 text-red-500 hover:bg-red-50 rounded",children:(0,w.jsx)(N.A,{size:16})})]},s);var r,a})})]})]})]})]}),!E&&(0,w.jsxs)("div",{className:"px-6 py-4 border-t border-neutral-200 bg-neutral-50 flex items-center gap-3",children:[(0,w.jsx)("div",{className:"flex-1"}),(0,w.jsx)("button",{type:"button",onClick:P,className:"px-5 py-2 border border-neutral-300 text-neutral-700 rounded-md hover:bg-neutral-100 transition-colors text-sm font-medium",children:"Cancel"}),(0,w.jsxs)("button",{type:"button",onClick:async()=>{if(W.problem.trim())if(0!==W.issueCategories.length||W.customIssue.trim()){if(D){if(!W.machineData.model.trim())return void z("Machine model is required","warning");if(!W.machineData.serialNumber.trim())return void z("Machine serial number is required","warning")}else if(!W.machineId)return void z("Please select a machine","warning");if(W.customerId||C)if(!C||W.customerData.companyName.trim())try{F(!0);const e=[...W.issueCategories];W.customIssue.trim()&&e.push("custom:".concat(W.customIssue.trim())),await S((0,t.A)((0,t.A)({},W),{},{issueCategories:e,isNewCustomer:C,isNewMachine:D,customerData:(0,t.A)((0,t.A)({},W.customerData),{},{phones:Array.isArray(W.customerData.phones)?W.customerData.phones.filter(e=>e.trim()):[],phone:(Array.isArray(W.customerData.phones)?W.customerData.phones[0]:"")||W.customerData.phone}),machineData:(0,t.A)((0,t.A)({},W.machineData),{},{mobileNumbers:W.machineData.mobileNumbers.filter(e=>e.trim())})}))}catch(e){console.error("Error submitting complaint:",e),z("Failed to create ticket. Please try again.","error")}finally{F(!1)}else z("Company name is required","warning");else z("Please select or create a customer","warning")}else z("Please select at least one issue category or describe the issue","warning");else z("Please describe the problem","warning")},disabled:!(()=>{if(!_)return!1;if(C){if(!W.customerData.companyName.trim())return!1}else if(!W.customerId)return!1;if(D){if(!W.machineData.model.trim()||!W.machineData.serialNumber.trim())return!1}else if(!W.machineId)return!1;return!!W.problem.trim()&&!(0===W.issueCategories.length&&!W.customIssue.trim())})()||E,className:"px-6 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium shadow-sm flex items-center gap-2",children:[(0,w.jsx)(d.A,{size:16}),"Create Ticket"]})]})]})})}},8280(e,s,r){r.d(s,{A:()=>t});const t=(0,r(5228).A)("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]])},9292(e,s,r){r.d(s,{A:()=>t});const t=(0,r(5228).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},9333(e,s,r){r.d(s,{A:()=>t});const t=(0,r(5228).A)("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]])}}]);
//# sourceMappingURL=171.0e34eee3.chunk.js.map