/*! For license information please see 921.aadd2e61.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkrole_based_frontend=self.webpackChunkrole_based_frontend||[]).push([[921],{4921(e,t,s){s.r(t),s.d(t,{default:()=>p});var l=s(9379),a=s(5043),c=s(5228);const i=(0,c.A)("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);var r=s(6833);const n=(0,c.A)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),o=(0,c.A)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var d=s(7819),m=s(349),h=s(579);function p(e){var t;let{complaintId:s,isEngineer:c=!1,isManager:p=!1}=e;const[x,u]=(0,a.useState)(null),[b,g]=(0,a.useState)([]),[f,j]=(0,a.useState)(!0),[v,y]=(0,a.useState)(""),[N,k]=(0,a.useState)(!1),[w,C]=(0,a.useState)([]),[A,S]=(0,a.useState)("");(0,a.useEffect)(()=>{E(),T()},[s]);const E=async()=>{try{j(!0);const e=await fetch("/api/checklists/complaints/".concat(s),{credentials:"include"}),t=await e.json();t.success?u(t.checklist):u(null)}catch(e){console.error("Error loading checklist:",e)}finally{j(!1)}},T=async()=>{try{const e=await fetch("/api/checklists/templates",{credentials:"include"}),t=await e.json();t.success&&g(t.items||[])}catch(e){console.error("Error loading templates:",e)}},z=async e=>{try{const t=await fetch("/api/checklists/".concat(x.id,"/review"),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({approved:e,reviewNotes:A})});if(t.ok){const e=await t.json();u(e.checklist),S("")}}catch(t){console.error("Error reviewing checklist:",t)}};if(f)return(0,h.jsx)(m.A,{});const M=x?x.items.filter(e=>e.completed).length:0,P=x?x.items.length:0,O=P>0?Math.round(M/P*100):0;return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsx)("div",{className:"flex items-center justify-between pb-4 border-b border-slate-200",children:(0,h.jsxs)("div",{children:[(0,h.jsxs)("h2",{className:"text-xl font-bold text-slate-900 flex items-center gap-2",children:[(0,h.jsx)(i,{size:24,className:"text-blue-600"}),"Service Checklist"]}),(0,h.jsx)("p",{className:"text-sm text-slate-500",children:"Ensure all service requirements are met"})]})}),x?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,h.jsxs)("p",{className:"font-bold text-slate-900",children:[M," of ",P," completed"]}),(0,h.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:[O,"%"]})]}),(0,h.jsx)("div",{className:"w-full bg-slate-200 rounded-full h-3",children:(0,h.jsx)("div",{className:"bg-green-500 h-3 rounded-full transition-all",style:{width:"".concat(O,"%")}})})]}),(0,h.jsxs)("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[(0,h.jsx)("p",{className:"text-sm text-slate-600",children:"Type"}),(0,h.jsx)("p",{className:"font-bold text-slate-900",children:x.checklistType})]}),(0,h.jsx)("div",{className:"space-y-2",children:x.items.map(e=>(0,h.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-lg border transition ".concat(e.completed?"bg-green-50 border-green-200":"bg-white border-slate-200 hover:border-slate-300"),children:[(0,h.jsx)("button",{onClick:()=>c&&(async e=>{if(!x)return;const t=x.items.map(t=>t.id===e?(0,l.A)((0,l.A)({},t),{},{completed:!t.completed}):t);try{const s=await fetch("/api/checklists/".concat(x.id,"/items/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({completed:t.find(t=>t.id===e).completed})});if(s.ok){const e=await s.json();u(e.checklist)}}catch(s){console.error("Error updating item:",s)}})(e.id),disabled:!c||x.isCompleted,className:"mt-1 flex-shrink-0 cursor-pointer disabled:opacity-50",children:e.completed?(0,h.jsx)(r.A,{className:"text-green-600",size:24}):(0,h.jsx)(n,{className:"text-slate-400",size:24})}),(0,h.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,h.jsx)("p",{className:"font-medium ".concat(e.completed?"text-green-700 line-through":"text-slate-900"),children:e.name}),e.notes&&(0,h.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:e.notes}),e.completedAt&&(0,h.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:["Completed: ",new Date(e.completedAt).toLocaleString()]})]})]},e.id))}),c&&!x.isCompleted&&(0,h.jsxs)("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[(0,h.jsxs)("label",{className:"flex items-center gap-2 font-bold text-slate-900 mb-3",children:[(0,h.jsx)(o,{size:20}),"Photo Evidence"]}),(0,h.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>C([...w,...Array.from(e.target.files)]),className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),w.length>0&&(0,h.jsxs)("p",{className:"text-sm text-slate-600 mt-2",children:[w.length," photo(s) selected"]})]}),c&&!x.isCompleted&&(0,h.jsx)("button",{onClick:async()=>{if(x&&x.items.every(e=>e.completed))try{const e=await fetch("/api/checklists/".concat(x.id,"/complete"),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({photoEvidenceUrls:w})});if(e.ok){const t=await e.json();u(t.checklist),alert("Checklist completed successfully!")}}catch(e){console.error("Error completing checklist:",e)}else alert("All items must be completed first")},disabled:O<100,className:"w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition font-bold",children:"Mark Checklist Complete"}),p&&x.isCompleted&&!x.reviewedAt&&(0,h.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-4",children:[(0,h.jsxs)("div",{className:"flex items-start gap-2",children:[(0,h.jsx)(d.A,{className:"text-amber-600 flex-shrink-0 mt-1",size:20}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"font-bold text-amber-900",children:"Pending Review"}),(0,h.jsxs)("p",{className:"text-sm text-amber-700",children:["Completed by ",null===(t=x.completedBy)||void 0===t?void 0:t.name]})]})]}),(0,h.jsx)("textarea",{value:A,onChange:e=>S(e.target.value),placeholder:"Add review notes...",className:"w-full px-3 py-2 border border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",rows:"3"}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)("button",{onClick:()=>z(!0),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:"Approve"}),(0,h.jsx)("button",{onClick:()=>z(!1),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Request Changes"})]})]}),x.reviewedAt&&(0,h.jsxs)("div",{className:"border rounded-lg p-4 ".concat("approved"===x.status?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[(0,h.jsx)("p",{className:"font-bold ".concat("approved"===x.status?"text-green-900":"text-yellow-900"),children:"approved"===x.status?"Approved":"Needs Revision"}),x.reviewNotes&&(0,h.jsx)("p",{className:"text-sm mt-2",children:x.reviewNotes})]})]}):(0,h.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:N?(0,h.jsxs)("div",{className:"text-left space-y-4",children:[(0,h.jsx)("label",{className:"block text-slate-700 font-bold",children:"Select Checklist Type"}),(0,h.jsxs)("select",{value:v,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"",children:"Choose a template..."}),(0,h.jsx)("option",{value:"Electrical Inspection",children:"Electrical Inspection"}),(0,h.jsx)("option",{value:"Refrigeration Service",children:"Refrigeration Service"}),(0,h.jsx)("option",{value:"HVAC Maintenance",children:"HVAC Maintenance"}),(0,h.jsx)("option",{value:"Plumbing Service",children:"Plumbing Service"})]}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)("button",{onClick:async()=>{if(v)try{const e=await fetch("/api/checklists",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({complaintId:s,checklistType:v,items:b.filter(e=>e.name)})});if(e.ok){const t=await e.json();u(t.checklist),k(!1),y("")}}catch(e){console.error("Error creating checklist:",e)}},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Create"}),(0,h.jsx)("button",{onClick:()=>k(!1),className:"flex-1 px-4 py-2 bg-slate-300 text-slate-700 rounded-lg hover:bg-slate-400 transition",children:"Cancel"})]})]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("p",{className:"text-slate-700 mb-4",children:"No checklist created yet"}),(0,h.jsx)("button",{onClick:()=>k(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Create Checklist"})]})})]})}},6833(e,t,s){s.d(t,{A:()=>l});const l=(0,s(5228).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])}}]);
//# sourceMappingURL=921.aadd2e61.chunk.js.map